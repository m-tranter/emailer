<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <title>Emailer</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body>
    <div class="container mt-3">
      <h1>Emailer</h1>
      <input class="d-block" type="text" id="to" placeholder="Email address" />
      <input
        class="d-block mt-2"
        type="text"
        id="subject"
        placeholder="Subject"
      />
      <label class="d-block mt-1" for="text">Enter message body:</label>
      <textarea cols="30" rows="3" id="text" placeholder="Message"></textarea>
      <div class="row g-0 mt-2">
        <div class="col-auto">
          <button class="d-block" onclick="send()" id="myBtn">Send</button>
        </div>

        <div class="col-auto ms-2">
          <div class="d-none spinner-border" id="spinner" role="status"></div>
        </div>
        <div class="col-4 ms-2"><p id="msg">&nbsp</p></div>
      </div>
    </div>
    <script>
      const myBtn = document.getElementById('myBtn');
      const to = document.getElementById('to');
      const subject = document.getElementById('subject');
      const text = document.getElementById('text');
      const spinner = document.getElementById('spinner');
      const msg = document.getElementById('msg');
      const toggle = (e) => {
        if (e.classList.contains('d-none')) {
          e.classList.remove('d-none');
        } else {
          e.classList.add('d-none');
        }
      };

      const send = () => {
        toggle(spinner);
        console.log(to.value);
        fetch('/send', {
          method: 'post',
          body: JSON.stringify({
            to: to.value,
            subject: subject.value,
            text: text.value,
          }),
          headers: {
            'Content-Type': 'application/json; charset=utf-8',
          },
        })
          .then((response) => {
            if (!response.ok) {
              msg.innerHTML = 'Something went wrong.';
              throw 'Invalid password';
            }
            msg.innerHTML = 'Message sent.';
          })
          .catch((error) => {
            console.log(error);
          })
          .finally(() => {
            toggle(spinner);
          });
      };
    </script>
  </body>
</html>
